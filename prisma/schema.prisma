generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum OrgStatus {
  PENDING
  APPROVED
  REJECTED
}

<<<<<<< HEAD
enum ElectionStatus {
  DRAFT
  ACTIVE
  CLOSED
  CANCELLED
}

enum CandidateMethod {
  MANUAL
  APPLICATION
}

enum ApplicationStatus {
  PENDING
  APPROVED
  REJECTED
}

enum VoterCodeStatus {
  UNUSED
  USED
  REVOKED
}

model SuperAdmin {
  id             String    @id @default(cuid())
  email          String    @unique
  passwordHash   String
  fullName       String
  isActive       Boolean   @default(true)
  lastLoginAt    DateTime?
  lastLoginIp    String?
  failedAttempts Int       @default(0)
  lockedUntil    DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  
  adminLogs      SuperAdminLog[]
}

model SuperAdminLog {
  id         String     @id @default(cuid())
  adminId    String
  admin      SuperAdmin @relation(fields: [adminId], references: [id])
  action     String
  targetType String?
  targetId   String?
  details    String?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime   @default(now())
}

model Organisation {
  id        String    @id @default(cuid())
  name      String
  type      String?
  email     String    @unique
  orgCode   String?   @unique
  status    OrgStatus @default(PENDING)
  createdAt DateTime  @default(now())
  
  elections  Election[]
  members    Member[]
  auditLogs  AuditLog[]
  voterCodes VoterCode[]
}

model Member {
  id           String       @id @default(cuid())
  orgId        String
  organisation Organisation @relation(fields: [orgId], references: [id])
  
  // Link to the specific election this member code belongs to
  electionId   String?
  election     Election?    @relation(fields: [electionId], references: [id])
  
  email        String?      
  fullName     String
  passwordHash String?
  memberCode   String       @unique
  role         String       @default("VOTER")
  
  // Account status - becomes DORMANT after election ends
  isActive     Boolean      @default(true)
  createdAt    DateTime     @default(now())
  
  ballots      Ballot[]
  applications CandidateApplication[]
}

model Election {
  id              String         @id @default(cuid())
  orgId           String
  organisation    Organisation   @relation(fields: [orgId], references: [id])
  title           String
  description     String?
  startDate       DateTime
  endDate         DateTime
  status          ElectionStatus @default(DRAFT)
  
  candidateMethod CandidateMethod @default(MANUAL)
  applicationStartDate DateTime?
  applicationEndDate   DateTime?
  
  numberOfVoters  Int            @default(0)
  showRealTimeResults Boolean    @default(false)
  
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @default(now()) @updatedAt
  
  positions       Position[]
  ballots         Ballot[]
  voterCodes      VoterCode[]
  applicationForm ApplicationFormField[]
  applications    CandidateApplication[]
  members         Member[]
}

model Position {
  id           String    @id @default(cuid())
  electionId   String
  election     Election  @relation(fields: [electionId], references: [id], onDelete: Cascade)
  name         String
  description  String?
  maxWinners   Int       @default(1)
  minVotes     Int       @default(1)
  maxVotes     Int       @default(1)
  displayOrder Int       @default(0)
  
  candidates   Candidate[]
  votes        Vote[]
  applications CandidateApplication[]
=======
// Super Admin - Platform Level Administration
model SuperAdmin {
  id            String    @id @default(cuid())
  email         String    @unique
  passwordHash  String
  fullName      String
  isActive      Boolean   @default(true)
  lastLoginAt   DateTime?
  lastLoginIp   String?
  failedAttempts Int      @default(0)
  lockedUntil   DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // Audit trail for super admin actions
  adminLogs     SuperAdminLog[]
}

model SuperAdminLog {
  id            String     @id @default(cuid())
  adminId       String
  admin         SuperAdmin @relation(fields: [adminId], references: [id])
  action        String     // LOGIN, LOGOUT, APPROVE_ORG, REJECT_ORG, etc.
  targetType    String?    // Organisation, Member, Election, etc.
  targetId      String?
  details       String?
  ipAddress     String?
  userAgent     String?
  createdAt     DateTime   @default(now())
}

model Organisation {
  id            String    @id @default(cuid())
  name          String
  type          String?   // School, NGO, Corp
  email         String    @unique
  orgCode       String?   @unique
  status        OrgStatus @default(PENDING)
  createdAt     DateTime  @default(now())
  
  // Relations
  elections     Election[]
  members       Member[]
  auditLogs     AuditLog[]
}

model Member {
  id            String       @id @default(cuid())
  orgId         String
  organisation  Organisation @relation(fields: [orgId], references: [id])
  
  email         String?      
  fullName      String
  passwordHash  String?      // Nullable because simple voters might only use a PIN/Code
  memberCode    String       @unique
  role          String       @default("VOTER") // ORG_ADMIN or VOTER
  
  ballots       Ballot[]
}

model Election {
  id              String       @id @default(cuid())
  orgId           String
  organisation    Organisation @relation(fields: [orgId], references: [id])
  title           String
  startDate       DateTime
  endDate         DateTime
  status          String       @default("DRAFT")
  
  positions       Position[]
  ballots         Ballot[]
}

model Position {
  id          String    @id @default(cuid())
  electionId  String
  election    Election  @relation(fields: [electionId], references: [id])
  name        String    // e.g. "President"
  candidates  Candidate[]
  votes       Vote[]
>>>>>>> 6c7180de8b91f8b1e67e5630306b7f3e7c27ebf7
}

model Candidate {
  id          String    @id @default(cuid())
  positionId  String
<<<<<<< HEAD
  position    Position  @relation(fields: [positionId], references: [id], onDelete: Cascade)
  name        String
  bio         String?
  photoUrl    String?
  manifesto   String?
  isApproved  Boolean   @default(true)
  displayOrder Int      @default(0)
  
  applicationId String? @unique
  application   CandidateApplication? @relation(fields: [applicationId], references: [id])
  
  votes       Vote[]
}

model ApplicationFormField {
  id           String   @id @default(cuid())
  electionId   String
  election     Election @relation(fields: [electionId], references: [id], onDelete: Cascade)
  
  fieldName    String
  fieldType    String
  isRequired   Boolean  @default(false)
  options      String?
  placeholder  String?
  displayOrder Int      @default(0)
  
  responses    ApplicationFieldResponse[]
}

model CandidateApplication {
  id          String            @id @default(cuid())
  electionId  String
  election    Election          @relation(fields: [electionId], references: [id], onDelete: Cascade)
  positionId  String
  position    Position          @relation(fields: [positionId], references: [id], onDelete: Cascade)
  applicantId String
  applicant   Member            @relation(fields: [applicantId], references: [id])
  
  status      ApplicationStatus @default(PENDING)
  reviewNotes String?
  reviewedAt  DateTime?
  reviewedBy  String?
  
  submittedAt DateTime          @default(now())
  
  responses   ApplicationFieldResponse[]
  candidate   Candidate?

  @@unique([electionId, positionId, applicantId])
}

model ApplicationFieldResponse {
  id            String               @id @default(cuid())
  applicationId String
  application   CandidateApplication @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  fieldId       String
  field         ApplicationFormField @relation(fields: [fieldId], references: [id], onDelete: Cascade)
  
  value         String
  fileUrl       String?
}

model VoterCode {
  id          String          @id @default(cuid())
  orgId       String
  organisation Organisation   @relation(fields: [orgId], references: [id])
  electionId  String
  election    Election        @relation(fields: [electionId], references: [id], onDelete: Cascade)
  
  code        String          @unique
  status      VoterCodeStatus @default(UNUSED)
  usedAt      DateTime?
  usedByIp    String?
  
  createdAt   DateTime        @default(now())
  printedAt   DateTime?
  
  ballot      Ballot?
}

model Ballot {
  id          String     @id @default(cuid())
  voterId     String
  voter       Member     @relation(fields: [voterId], references: [id])
  electionId  String
  election    Election   @relation(fields: [electionId], references: [id])
  voterCodeId String?    @unique
  voterCode   VoterCode? @relation(fields: [voterCodeId], references: [id])
  createdAt   DateTime   @default(now())
  ipAddress   String?
  votes       Vote[]

  @@unique([voterId, electionId])
}

model Vote {
  id          String    @id @default(cuid())
  ballotId    String?
  ballot      Ballot?   @relation(fields: [ballotId], references: [id], onDelete: Cascade)
=======
  position    Position  @relation(fields: [positionId], references: [id])
  name        String
  votes       Vote[]
}

// ANTI-FRAUD LAYER: Tracks WHO voted
model Ballot {
  id          String    @id @default(cuid())
  voterId     String
  voter       Member    @relation(fields: [voterId], references: [id])
  electionId  String
  election    Election  @relation(fields: [electionId], references: [id])
  createdAt   DateTime  @default(now())
  ipAddress   String?
}

// SECRET LAYER: Tracks WHAT was voted (No link to Member!)
model Vote {
  id          String    @id @default(cuid())
>>>>>>> 6c7180de8b91f8b1e67e5630306b7f3e7c27ebf7
  positionId  String
  position    Position  @relation(fields: [positionId], references: [id])
  candidateId String
  candidate   Candidate @relation(fields: [candidateId], references: [id])
<<<<<<< HEAD

  @@unique([ballotId, positionId, candidateId])
}

model AuditLog {
  id           String       @id @default(cuid())
  orgId        String
  organisation Organisation @relation(fields: [orgId], references: [id])
  action       String
  description  String
  actorId      String
  ipAddress    String?
  createdAt    DateTime     @default(now())
}
=======
}

model AuditLog {
  id              String       @id @default(cuid())
  orgId           String
  organisation    Organisation @relation(fields: [orgId], references: [id])
  action          String
  description     String
  actorId         String
  ipAddress       String?
  createdAt       DateTime     @default(now())
}
>>>>>>> 6c7180de8b91f8b1e67e5630306b7f3e7c27ebf7
